<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ficha de Avalia√ß√£o ¬∑ Instala√ß√£o El√©trica Predial</title>
    <!-- Bibliotecas para gera√ß√£o de PDF -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        :root {
            /* SENAI Hub Colors */
            --senai-blue-dark: #0e58c7;
            --senai-blue-medium: #005090;
            --senai-blue-light: #e0f2f7;
            --senai-orange: #ff6600;
            --senai-orange-light: #fff2e0;

            --background-body: #f4f7f9;
            --background-container: #ffffff;
            --background-card: #f8faff;
            --text-color-dark: #2c3e50;
            --text-color-medium: #556b82;
            --border-color-light: #d8e2e9;
            --border-color-medium: #c0d0e0;
            --shadow-color: rgba(0, 0, 0, 0.1);

            --base-font-size: 16px;
            --main-padding-v: 1.5rem;
            --main-padding-h: 1.25rem;
            --gap-sm: 0.3125rem;
            --gap-md: 0.75rem;
            --gap-lg: 1rem;
        }

        * {
            box-sizing: border-box;
            font-family: 'Segoe UI', Roboto, system-ui, sans-serif;
            color: var(--text-color-dark);
        }
        html {
            font-size: var(--base-font-size);
        }
        body {
            background: var(--background-body);
            margin: 0;
            padding: clamp(1rem, 5vw, 2.5rem);
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        #senaiHubBranding {
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: clamp(1.8rem, 5vw, 2.8rem);
            font-weight: 800;
            text-transform: uppercase;
            margin-bottom: clamp(1rem, 2vw, 2rem);
            padding: clamp(0.5rem, 1vw, 1rem);
            width: 100%;
            max-width: 1400px;
            line-height: 1;
        }
        #senaiHubBranding .senai-text {
            color: var(--senai-blue-dark);
        }
        #senaiHubBranding .hub-text {
            color: var(--senai-orange);
            margin-left: 0.2em;
        }

        .container {
            max-width: 1400px;
            width: 100%;
            background: var(--background-container);
            border-radius: 20px;
            box-shadow: 0 12px 30px var(--shadow-color);
            padding: var(--main-padding-v) var(--main-padding-h);
        }

        .header {
            border-bottom: 2px solid var(--senai-blue-dark);
            margin-bottom: 1.25rem;
            padding-bottom: 0.75rem;
        }
        .header h1 {
            font-size: clamp(1.5rem, 4vw, 1.9rem);
            color: var(--senai-blue-dark);
            margin: 0 0 0.25rem;
            font-weight: 600;
            letter-spacing: -0.2px;
        }
        .header h2 {
            font-size: clamp(1rem, 3vw, 1.2rem);
            color: var(--senai-blue-medium);
            font-weight: 400;
            margin: 0 0 0.5rem;
            display: flex;
            flex-wrap: wrap;
            align-items: center;
            gap: var(--gap-sm) var(--gap-md);
        }
        .header .desafio {
            background: var(--senai-blue-light);
            padding: 0.5rem 1rem;
            border-radius: 30px;
            display: inline-block;
            font-weight: 500;
            color: var(--senai-blue-dark);
            margin: 0.5rem 0 0.25rem;
            border-left: 5px solid var(--senai-orange);
        }

        .legend-grid {
            display: flex;
            flex-wrap: wrap;
            gap: var(--gap-md);
            background: var(--background-card);
            padding: 1.125rem 1rem;
            border-radius: 28px;
            margin: 1.25rem 0 1.5625rem;
            border: 1px solid var(--border-color-light);
            justify-content: space-around;
        }
        .legend-item {
            flex: 1 1 clamp(150px, 20vw, 200px);
            padding: 0.5rem 0.875rem;
            border-radius: 40px;
            font-weight: 500;
            background: var(--background-container);
            box-shadow: 0 2px 5px rgba(0,0,0,0.02);
            border-left: 6px solid;
        }
        .item-a { border-color: #1e7e34; background: #e6f3e6; }
        .item-b { border-color: var(--senai-blue-medium); background: var(--senai-blue-light); }
        .item-c { border-color: var(--senai-orange); background: var(--senai-orange-light); }
        .item-d { border-color: #b13e3e; background: #ffe6e6; }
        .item-desc {
            font-size: 0.95rem;
            color: var(--text-color-dark);
        }
        .item-desc strong { font-size: 1.2rem; margin-right: 0.375rem; }

        .table-wrapper {
            overflow-x: auto;
            border-radius: 18px;
            border: 1px solid var(--border-color-medium);
            background: var(--background-container);
            margin: 1.125rem 0 1.5625rem;
            box-shadow: 0 6px 12px var(--shadow-color);
        }
        table {
            width: 100%;
            border-collapse: collapse;
            min-width: 1200px;
            font-size: 0.85rem;
        }
        th {
            background: var(--senai-blue-dark);
            color: white;
            font-weight: 600;
            padding: 0.5rem 0.375rem;
            text-align: center;
            vertical-align: middle;
            border-right: 1px solid var(--senai-blue-medium);
            white-space: normal;
            word-break: break-word;
            line-height: 1.3;
        }
        th:last-child {
            border-right: none;
        }
        td {
            border: 1px solid var(--border-color-medium);
            padding: 0.5rem 0.3125rem;
            vertical-align: middle;
            background-color: var(--background-container);
        }
        tr:nth-child(even) td {
            background-color: var(--senai-blue-light);
        }
        .aluno-nome {
            min-width: 200px;
        }
        .name-display-wrapper {
            display: flex;
            align-items: center;
            gap: var(--gap-sm);
            width: 100%;
        }
        .name-display-wrapper .edit-name-input {
            width: 100%;
            font-weight: 500;
            background: var(--senai-blue-light);
        }
        .static-name-text {
            flex-grow: 1;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            font-weight: 500;
            color: var(--text-color-dark);
            background: var(--senai-blue-light);
            padding: 0.5rem;
            border-radius: 10px;
            height: 2.375rem;
            display: flex;
            align-items: center;
            border: 1px solid var(--border-color-medium);
            box-shadow: inset 0 1px 3px rgba(0,0,0,0.03);
            cursor: pointer;
        }
        .static-name-text:hover {
            border-color: var(--senai-orange);
            box-shadow: 0 0 0 3px rgba(255,102,0,0.2);
        }
        .edit-name-btn {
            background: var(--senai-blue-light);
            border: 1px solid var(--border-color-medium);
            color: var(--senai-blue-dark);
            border-radius: 50%;
            min-width: 1.875rem;
            height: 1.875rem;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 1rem;
            transition: background 0.15s, transform 0.15s;
            flex-shrink: 0;
        }
        .edit-name-btn:hover {
            background: var(--senai-blue-medium);
            color: white;
            transform: scale(1.05);
        }
        input, textarea {
            border: 1px solid var(--border-color-medium);
            border-radius: 10px;
            padding: 0.5rem;
            font-size: 0.85rem;
            transition: 0.15s;
            background: var(--background-container);
            box-shadow: inset 0 1px 3px rgba(0,0,0,0.03);
        }
        input:focus, textarea:focus {
            border-color: var(--senai-orange);
            outline: none;
            box-shadow: 0 0 0 3px rgba(255,102,0,0.2);
        }
        input[type=number] {
            text-align: center;
            -moz-appearance: textfield;
            width: 70px;
        }
        input[type=number]::-webkit-outer-spin-button,
        input[type=number]::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }
        .media-cell {
            font-weight: 700;
            background-color: var(--senai-blue-light) !important;
            text-align: center;
            font-size: 1rem;
            color: var(--senai-blue-dark);
            white-space: nowrap;
        }
        .obs-cell {
            min-width: 180px;
        }
        .obs-cell input {
            background: var(--senai-orange-light);
            width: 100%;
        }
        .acao-remover {
            text-align: center;
            width: 50px;
        }
        .btn-remove {
            background: none;
            border: none;
            font-size: 1.6rem;
            line-height: 1;
            cursor: pointer;
            color: #d00000;
            padding: 0 0.375rem;
            border-radius: 30px;
            transition: 0.1s;
        }
        .btn-remove:hover {
            color: #ff0000;
            background: #ffe3e3;
            transform: scale(1.1);
        }

        .docente-info-card {
            background: var(--background-card);
            padding: 1.125rem 1rem;
            border-radius: 28px;
            margin: 1.25rem 0 1.5625rem;
            border: 1px solid var(--border-color-light);
            display: flex;
            flex-wrap: wrap;
            align-items: center;
            gap: 0.625rem;
            font-weight: 500;
        }
        .docente-info-card h3 {
            margin: 0;
            font-size: 1.1rem;
            color: var(--senai-blue-dark);
            font-weight: 700;
            margin-right: 0.3125rem;
        }
        .editable-text-display {
            flex-grow: 1;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            font-weight: 500;
            color: var(--text-color-dark);
            background: var(--senai-blue-light);
            padding: 0.5rem;
            border-radius: 10px;
            height: 2.375rem;
            display: flex;
            align-items: center;
            border: 1px solid var(--border-color-medium);
            box-shadow: inset 0 1px 3px rgba(0,0,0,0.03);
            cursor: pointer;
            min-width: 9.375rem;
        }
        .editable-text-display:hover {
            border-color: var(--senai-orange);
            box-shadow: 0 0 0 3px rgba(255,102,0,0.2);
        }
        .editable-input {
            flex-grow: 1;
            background: var(--senai-blue-light);
            font-weight: 500;
            min-width: 9.375rem;
        }
        .edit-btn {
            background: var(--senai-blue-light);
            border: 1px solid var(--border-color-medium);
            color: var(--senai-blue-dark);
            border-radius: 50%;
            min-width: 1.875rem;
            height: 1.875rem;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 1rem;
            transition: background 0.15s, transform 0.15s;
            flex-shrink: 0;
        }
        .edit-btn:hover {
            background: var(--senai-blue-medium);
            color: white;
            transform: scale(1.05);
        }
        .editable-header-display {
            font-size: clamp(1rem, 3vw, 1.2rem);
            font-weight: 400;
            color: var(--senai-blue-medium);
            padding: 0.25rem 0.375rem;
            border: 1px solid transparent;
            border-radius: 6px;
            cursor: pointer;
            transition: border-color 0.15s, box-shadow 0.15s, background 0.15s;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            line-height: 1.4;
        }
        .editable-header-display:hover {
            border-color: var(--senai-blue-light);
            box-shadow: 0 0 0 2px rgba(0,80,144,0.1);
            background: var(--senai-blue-light);
        }
        .editable-header-input {
            font-size: clamp(1rem, 3vw, 1.2rem);
            font-weight: 400;
            color: var(--senai-blue-medium);
            padding: 0.25rem 0.375rem;
            border-radius: 6px;
            background: var(--senai-blue-light);
            min-width: 9.375rem;
            flex-grow: 1;
        }
        .small-edit-btn {
            width: 1.5rem;
            height: 1.5rem;
            font-size: 0.8rem;
            background: var(--senai-blue-light);
            border: 1px solid var(--border-color-medium);
        }
        .small-edit-btn:hover {
            background: var(--senai-blue-medium);
            color: white;
        }
        .editable-desafio-display {
            font-weight: 500;
            color: var(--senai-blue-dark);
            padding: 0.5rem 1rem;
            border-radius: 30px;
            border-left: 5px solid var(--senai-orange);
            background: var(--senai-blue-light);
            cursor: pointer;
            transition: background 0.15s, border-color 0.15s, box-shadow 0.15s;
            display: inline-flex;
            align-items: center;
            gap: var(--gap-sm);
            margin: 0.5rem 0 0.25rem;
        }
        .editable-desafio-display:hover {
            border-color: var(--senai-blue-dark);
            box-shadow: 0 0 0 3px rgba(0,51,102,0.1);
            background: #d8eef5;
        }
        .editable-desafio-input {
            width: 100%;
            font-weight: 500;
            color: var(--senai-blue-dark);
            padding: 0.5rem 1rem;
            border-radius: 30px;
            border: 1px solid var(--border-color-medium);
            background: var(--senai-blue-light);
            box-shadow: inset 0 1px 3px rgba(0,0,0,0.03);
            border-left: 5px solid var(--senai-orange);
            margin: 0.5rem 0 0.25rem;
        }
        .desafio-edit-wrapper {
            display: flex;
            align-items: center;
            gap: var(--gap-sm);
            width: 100%;
        }

        .th-content-wrapper {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: var(--gap-sm);
            flex-wrap: wrap;
            min-height: 2.5rem;
        }
        .editable-th-display {
            flex-grow: 1;
            color: white;
            font-weight: 600;
            padding: 0.25rem 0.375rem;
            border: 1px solid transparent;
            border-radius: 6px;
            cursor: pointer;
            transition: border-color 0.15s, background 0.15s;
            text-shadow: 0 1px 2px rgba(0,0,0,0.2);
            line-height: 1.2;
            word-break: break-word;
        }
        .editable-th-display:hover {
            border-color: var(--senai-orange);
            background: rgba(255,102,0,0.1);
            box-shadow: 0 0 0 2px rgba(255,102,0,0.1);
        }
        .editable-th-input {
            flex-grow: 1;
            min-width: 5rem;
            background: var(--senai-blue-light);
            color: var(--senai-blue-dark);
            padding: 0.25rem 0.375rem;
            border-radius: 6px;
            font-size: 0.85rem;
            font-weight: 500;
            text-align: center;
        }
        .th-edit-btn {
            background: rgba(255,255,255,0.2);
            border-color: rgba(255,255,255,0.3);
            color: white;
            opacity: 0.8;
        }
        .th-edit-btn:hover {
            background: rgba(255,102,0,0.3);
            opacity: 1;
        }

        .toolbar {
            display: flex;
            flex-wrap: wrap;
            gap: 0.875rem;
            margin: 1.5625rem 0 0.9375rem;
            align-items: center;
        }
        .btn {
            background: var(--senai-blue-dark);
            border: none;
            color: white;
            padding: 0.75rem 1.5rem;
            border-radius: 50px;
            font-weight: 600;
            font-size: 0.95rem;
            cursor: pointer;
            box-shadow: 0 4px 8px var(--shadow-color);
            transition: all 0.15s;
            border: 1px solid var(--senai-blue-dark);
            display: inline-flex;
            align-items: center;
            gap: 0.375rem;
        }
        .btn-secondary {
            background: var(--senai-orange);
            border-color: var(--senai-orange);
        }
        .btn-light {
            background: var(--background-card);
            color: var(--senai-blue-dark);
            border: 1px solid var(--border-color-medium);
            box-shadow: none;
        }
        .btn:hover {
            background: var(--senai-blue-medium);
            transform: translateY(-2px);
            border-color: var(--senai-blue-medium);
        }
        .btn-secondary:hover {
            background: #e65c00;
            border-color: #e65c00;
        }
        .btn-light:hover {
            background: var(--senai-blue-light);
        }
        .obs-docente {
            background: var(--background-card);
            border-radius: 24px;
            padding: 1.125rem 1.375rem;
            margin-top: 1.25rem;
            border: 1px dashed var(--senai-orange);
        }
        .obs-docente label {
            font-weight: 700;
            color: var(--senai-blue-dark);
            display: block;
            margin-bottom: 0.625rem;
            font-size: 1.1rem;
        }
        .obs-docente textarea {
            width: 100%;
            min-height: 5rem;
            border-radius: 18px;
            padding: 0.875rem 1.125rem;
            background: var(--background-container);
            border: 1px solid var(--border-color-medium);
        }
        .footer-note {
            font-size: 0.8rem;
            color: var(--text-color-medium);
            text-align: right;
            margin-top: 1rem;
        }
        .media-conceito {
            display: inline-block;
            background: var(--senai-blue-dark);
            color: white;
            padding: 0.125rem 0.625rem;
            border-radius: 30px;
            font-size: 0.75rem;
            margin-left: 0.3125rem;
        }
        .nota-max {
            font-size: 0.7rem;
            color: var(--text-color-medium);
            display: block;
            margin-top: 0.25rem;
        }
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 51, 102, 0.9);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            color: white;
            font-size: 1.5rem;
            font-weight: bold;
            z-index: 1000;
            text-align: center;
            gap: 1rem;
        }
        .loading-overlay .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid var(--senai-orange);
            border-radius: 50%;
            width: 2.5rem;
            height: 2.5rem;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        @media (max-width: 1200px) {
            .container { padding: var(--main-padding-v) 1rem; }
            .toolbar { gap: 0.625rem; }
            .btn { padding: 0.625rem 1.25rem; font-size: 0.9rem; }
            table { font-size: 0.8rem; }
            .aluno-nome { min-width: 180px; }
            .obs-cell { min-width: 150px; }
        }
        @media (max-width: 768px) {
            .header h2 { flex-direction: column; align-items: flex-start; }
            .legend-item { flex: 1 1 100%; }
            .docente-info-card { flex-direction: column; align-items: flex-start; }
            .toolbar { flex-direction: column; align-items: stretch; }
            .toolbar .btn { width: 100%; }
        }
    </style>
</head>
<body>
<div id="senaiHubBranding">
    <span class="senai-text">SENAI</span><span class="hub-text">HUB</span>
</div>
<div class="container" id="mainContainer">
    <div class="header">
        <h1>‚ö° INSTRUMENTO PARA ACOMPANHAMENTO DE AVALIA√á√ÉO</h1>
        <h2>
            <span id="courseNameStatic" class="editable-header-display">T√âCNICO EM ELETROT√âCNICA</span>
            <input type="text" id="courseNameInput" class="editable-header-input" style="display:none;" />
            <button class="edit-btn small-edit-btn" aria-label="Editar nome do curso">‚úèÔ∏è</button>
            <span> ¬∑ </span>
            <span id="courseContextStatic" class="editable-header-display">ESCOLA INTEGRAL ¬∑ 1¬∫ ANO ¬∑ MATRIZ 1.640H ¬∑ 2022-2024</span>
            <input type="text" id="courseContextInput" class="editable-header-input" style="display:none;" />
            <button class="edit-btn small-edit-btn" aria-label="Editar contexto do curso">‚úèÔ∏è</button>
            <span> ¬∑ </span>
            <span id="curricularUnitStatic" class="editable-header-display">DISCIPLINA DE AN√ÅLISE DE CIRCUITOS</span>
            <input type="text" id="curricularUnitInput" class="editable-header-input" style="display:none;" />
            <button class="edit-btn small-edit-btn" aria-label="Editar unidade curricular">‚úèÔ∏è</button>
        </h2>
        <div class="desafio-edit-wrapper">
            <span id="desafioStatic" class="editable-desafio-display">üìã DESAFIO: Portf√≥lio ‚Äì Etapa 2 (ESPEC√çFICO I - ELETRICIDADE)</span>
            <input type="text" id="desafioInput" class="editable-desafio-input" style="display:none;" />
            <button class="edit-btn small-edit-btn" aria-label="Editar desafio">‚úèÔ∏è</button>
        </div>
    </div>

    <div class="docente-info-card">
        <h3>DOCENTE:</h3>
        <span id="docentNameStatic" class="editable-text-display">ESTER MAIA</span>
        <input type="text" id="docentNameInput" class="editable-input" style="display:none;" />
        <button class="edit-btn" aria-label="Editar nome do docente">‚úèÔ∏è</button>
    </div>

    <div class="legend-grid">
        <div class="legend-item item-a"><span class="item-desc"><strong>A (9‚Äì10)</strong> Desenvolveu atendendo todos os crit√©rios, resultado esperado.</span></div>
        <div class="legend-item item-b"><span class="item-desc"><strong>B (7‚Äì8,9)</strong> Atendeu maior parte, sem comprometer resultado.</span></div>
        <div class="legend-item item-c"><span class="item-desc"><strong>C (4‚Äì6,9)</strong> Atendeu poucos crit√©rios, comprometeu resultado.</span></div>
        <div class="legend-item item-d"><span class="item-desc"><strong>D (1‚Äì3,9)</strong> N√£o desenvolveu ou n√£o atendeu crit√©rios.</span></div>
    </div>

    <div class="table-wrapper">
        <table id="avaliacaoTable">
            <thead>
                <tr>
                    <th>üë§ ALUNOS</th>
                    <th>
                        <div class="th-content-wrapper">
                            <span id="criterion1Static" class="editable-th-display">1. CC¬∑ Tens√µes e correntes</span>
                            <input type="text" id="criterion1Input" class="editable-th-input" style="display:none;" />
                            <button class="edit-btn small-edit-btn th-edit-btn" aria-label="Editar crit√©rio 1">‚úèÔ∏è</button>
                        </div>
                        <span class="nota-max">(0-10)</span>
                    </th>
                    <th>
                        <div class="th-content-wrapper">
                            <span id="criterion2Static" class="editable-th-display">1. CC¬∑ Resist√™ncia equiv.</span>
                            <input type="text" id="criterion2Input" class="editable-th-input" style="display:none;" />
                            <button class="edit-btn small-edit-btn th-edit-btn" aria-label="Editar crit√©rio 2">‚úèÔ∏è</button>
                        </div>
                        <span class="nota-max">(0-10)</span>
                    </th>
                    <th>
                        <div class="th-content-wrapper">
                            <span id="criterion3Static" class="editable-th-display">1. CC¬∑ Pot√™ncia total</span>
                            <input type="text" id="criterion3Input" class="editable-th-input" style="display:none;" />
                            <button class="edit-btn small-edit-btn th-edit-btn" aria-label="Editar crit√©rio 3">‚úèÔ∏è</button>
                        </div>
                        <span class="nota-max">(0-10)</span>
                    </th>
                    <th>
                        <div class="th-content-wrapper">
                            <span id="criterion4Static" class="editable-th-display">2. CA¬∑ Tens√µes/correntes eficazes</span>
                            <input type="text" id="criterion4Input" class="editable-th-input" style="display:none;" />
                            <button class="edit-btn small-edit-btn th-edit-btn" aria-label="Editar crit√©rio 4">‚úèÔ∏è</button>
                        </div>
                        <span class="nota-max">(0-10)</span>
                    </th>
                    <th>
                        <div class="th-content-wrapper">
                            <span id="criterion5Static" class="editable-th-display">2. CA¬∑ Imped√¢ncia equiv.</span>
                            <input type="text" id="criterion5Input" class="editable-th-input" style="display:none;" />
                            <button class="edit-btn small-edit-btn th-edit-btn" aria-label="Editar crit√©rio 5">‚úèÔ∏è</button>
                        </div>
                        <span class="nota-max">(0-10)</span>
                    </th>
                    <th>
                        <div class="th-content-wrapper">
                            <span id="criterion6Static" class="editable-th-display">2. CA¬∑ Pot. aparente/ativa/reativa</span>
                            <input type="text" id="criterion6Input" class="editable-th-input" style="display:none;" />
                            <button class="edit-btn small-edit-btn th-edit-btn" aria-label="Editar crit√©rio 6">‚úèÔ∏è</button>
                        </div>
                        <span class="nota-max">(0-10)</span>
                    </th>
                    <th>
                        <div class="th-content-wrapper">
                            <span id="criterion7Static" class="editable-th-display">‚öñÔ∏è Aval. equipe + cr√≠tica</span>
                            <input type="text" id="criterion7Input" class="editable-th-input" style="display:none;" />
                            <button class="edit-btn small-edit-btn th-edit-btn" aria-label="Editar crit√©rio 7">‚úèÔ∏è</button>
                        </div>
                        <span class="nota-max">(0-10)</span>
                    </th>
                    <th>üìä M√©dia Final (conceito)</th>
                    <th>üóëÔ∏è A√ß√µes</th>
                    <th>üìù Observa√ß√£o (individual)</th>
                </tr>
            </thead>
            <tbody id="tbodyAlunos">
                <!-- linhas ser√£o inseridas via JS -->
            </tbody>
        </table>
    </div>

    <div class="toolbar">
        <button class="btn" id="addAlunoBtn">‚ûï Adicionar aluno</button>
        <button class="btn btn-secondary" id="saveLocalBtn">üíæ Salvar dados (navegador)</button>
        <button class="btn btn-light" id="loadLocalBtn">üìÇ Carregar √∫ltimos salvos</button>
        <button class="btn btn-secondary" id="downloadPdfBtn">üì• Baixar PDF</button>
        <span style="flex:1; text-align: right; color: var(--text-color-medium);">M√©dia calculada automaticamente (soma/7)</span>
    </div>

    <div class="obs-docente">
        <label>üóíÔ∏è OBSERVA√á√ïES DO DOCENTE (geral / justificativas):</label>
        <textarea id="docenteObservacoes" placeholder="Caso o docente sinta necessidade de descrever o porqu√™ o aluno n√£o desenvolveu os crit√©rios, ou outras observa√ß√µes..."></textarea>
    </div>
    <div class="footer-note">
        * Clique em "Salvar dados" para guardar no navegador. As m√©dias s√£o recalculadas a cada altera√ß√£o.
    </div>
</div>

<div id="loadingOverlay" class="loading-overlay" style="display:none;">
    <div class="spinner"></div>
    Gerando PDF... Por favor, aguarde.
</div>

<script>
    (function() {
        const tbody = document.getElementById('tbodyAlunos');
        const addBtn = document.getElementById('addAlunoBtn');
        const saveBtn = document.getElementById('saveLocalBtn');
        const loadBtn = document.getElementById('loadLocalBtn');
        const downloadPdfBtn = document.getElementById('downloadPdfBtn');
        const mainContainer = document.getElementById('mainContainer');
        const loadingOverlay = document.getElementById('loadingOverlay');
        const docenteTextarea = document.getElementById('docenteObservacoes');
        const LOCAL_STORAGE_KEY = 'fichaEletrica';

        // Refer√™ncias dos elementos edit√°veis
        const docentNameStatic = document.getElementById('docentNameStatic');
        const docentNameInput = document.getElementById('docentNameInput');
        const docentNameEditBtn = docentNameInput.nextElementSibling;

        const courseNameStatic = document.getElementById('courseNameStatic');
        const courseNameInput = document.getElementById('courseNameInput');
        const courseNameEditBtn = courseNameInput.nextElementSibling;

        const courseContextStatic = document.getElementById('courseContextStatic');
        const courseContextInput = document.getElementById('courseContextInput');
        const courseContextEditBtn = courseContextInput.nextElementSibling;

        const curricularUnitStatic = document.getElementById('curricularUnitStatic');
        const curricularUnitInput = document.getElementById('curricularUnitInput');
        const curricularUnitEditBtn = curricularUnitInput.nextElementSibling;

        const desafioStatic = document.getElementById('desafioStatic');
        const desafioInput = document.getElementById('desafioInput');
        const desafioEditBtn = desafioInput.nextElementSibling;

        const criterionStatics = [];
        const criterionInputs = [];
        const criterionEditBtns = [];
        for (let i = 1; i <= 7; i++) {
            criterionStatics.push(document.getElementById(`criterion${i}Static`));
            criterionInputs.push(document.getElementById(`criterion${i}Input`));
            criterionEditBtns.push(document.getElementById(`criterion${i}Input`).nextElementSibling);
        }

        function obterConceito(media) {
            if (media >= 9) return 'A';
            if (media >= 7) return 'B';
            if (media >= 4) return 'C';
            if (media >= 1) return 'D';
            return '‚Äî';
        }

        function calcularMediaLinha(row) {
            const inputsNota = row.querySelectorAll('.nota-criterio');
            let soma = 0;
            inputsNota.forEach(inp => {
                let val = parseFloat(inp.value);
                if (isNaN(val)) val = 0;
                val = Math.min(10, Math.max(0, val));
                inp.value = val;
                soma += val;
            });
            return inputsNota.length ? soma / inputsNota.length : 0;
        }

        function atualizarExibicaoMedia(row) {
            const media = calcularMediaLinha(row);
            const mediaCell = row.querySelector('.media-valor');
            if (mediaCell) {
                const conceito = obterConceito(media);
                mediaCell.innerHTML = `${media.toFixed(2)} <span class="media-conceito">${conceito}</span>`;
            }
        }

        function atualizarTodasMedias() {
            tbody.querySelectorAll('tr').forEach(row => atualizarExibicaoMedia(row));
        }

        function setupEditableField(staticElem, inputElem, editBtn, defaultValue = '') {
            const toggleMode = (isEditing) => {
                if (isEditing) {
                    inputElem.style.display = 'inline-block';
                    staticElem.style.display = 'none';
                    if (editBtn) editBtn.style.display = 'none';
                    inputElem.focus();
                    inputElem.select();
                } else {
                    let currentValue = inputElem.value.trim();
                    if (currentValue === '') currentValue = defaultValue;
                    inputElem.value = currentValue;
                    staticElem.textContent = currentValue;
                    inputElem.style.display = 'none';
                    staticElem.style.display = 'inline-block';
                    if (editBtn) editBtn.style.display = 'inline-block';
                    salvarNoLocalStorage();
                }
            };

            staticElem.addEventListener('click', () => toggleMode(true));
            if (editBtn) editBtn.addEventListener('click', () => toggleMode(true));
            inputElem.addEventListener('blur', () => toggleMode(false));
            inputElem.addEventListener('keyup', (event) => {
                if (event.key === 'Enter') inputElem.blur();
            });

            inputElem.value = staticElem.textContent.trim() || defaultValue;
            toggleMode(inputElem.value.trim() === '');
        }

        function criarLinha(dados = null) {
            const tr = document.createElement('tr');
            const tdNome = document.createElement('td');
            tdNome.className = 'aluno-nome';
            const nameWrapper = document.createElement('div');
            nameWrapper.className = 'name-display-wrapper';

            const inpNome = document.createElement('input');
            inpNome.type = 'text';
            inpNome.placeholder = 'Nome do aluno';
            inpNome.value = dados?.nome || '';
            inpNome.classList.add('edit-name-input');

            const spanName = document.createElement('span');
            spanName.className = 'static-name-text';
            spanName.textContent = inpNome.value.trim() || 'Nome do aluno';

            const btnEdit = document.createElement('button');
            btnEdit.className = 'edit-name-btn';
            btnEdit.innerHTML = '‚úèÔ∏è';
            btnEdit.setAttribute('aria-label', 'Editar nome do aluno');

            nameWrapper.appendChild(inpNome);
            nameWrapper.appendChild(spanName);
            nameWrapper.appendChild(btnEdit);
            tdNome.appendChild(nameWrapper);
            tr.appendChild(tdNome);

            setupEditableField(spanName, inpNome, btnEdit, 'Nome do aluno');

            const notasIniciais = dados?.notas || [0,0,0,0,0,0,0];
            for (let i = 0; i < 7; i++) {
                const td = document.createElement('td');
                const inp = document.createElement('input');
                inp.type = 'number';
                inp.step = '0.1';
                inp.min = '0';
                inp.max = '10';
                inp.value = notasIniciais[i] !== undefined ? notasIniciais[i] : 0;
                inp.classList.add('nota-criterio');
                inp.addEventListener('input', function(e) {
                    let val = parseFloat(e.target.value);
                    if (isNaN(val)) val = 0;
                    val = Math.min(10, Math.max(0, val));
                    e.target.value = val;
                    atualizarExibicaoMedia(tr);
                });
                td.appendChild(inp);
                tr.appendChild(td);
            }

            const tdMedia = document.createElement('td');
            tdMedia.className = 'media-cell';
            const spanMedia = document.createElement('span');
            spanMedia.className = 'media-valor';
            tdMedia.appendChild(spanMedia);
            tr.appendChild(tdMedia);

            const tdAcao = document.createElement('td');
            tdAcao.className = 'acao-remover';
            const btnRemove = document.createElement('button');
            btnRemove.className = 'btn-remove';
            btnRemove.innerHTML = '‚úï';
            btnRemove.setAttribute('aria-label', 'remover aluno');
            btnRemove.addEventListener('click', function() {
                if (tbody.children.length > 1) {
                    tr.remove();
                    salvarNoLocalStorage();
                } else {
                    alert('A ficha precisa de pelo menos um aluno.');
                }
            });
            tdAcao.appendChild(btnRemove);
            tr.appendChild(tdAcao);

            const tdObs = document.createElement('td');
            tdObs.className = 'obs-cell';
            const inpObs = document.createElement('input');
            inpObs.type = 'text';
            inpObs.placeholder = 'Obs. individual...';
            inpObs.value = dados?.obs || '';
            tdObs.appendChild(inpObs);
            tr.appendChild(tdObs);

            atualizarExibicaoMedia(tr);
            return tr;
        }

        function inicializarExemplos() {
            tbody.innerHTML = '';
            tbody.appendChild(criarLinha({ nome: 'Jo√£o Pedro', notas: [8.5,9.0,7.5,8.0,7.0,8.5,9.5], obs: 'Bom dom√≠nio de corrente alternada' }));
            tbody.appendChild(criarLinha({ nome: 'Maria Fernanda', notas: [6.0,5.5,6.5,7.0,6.0,5.0,8.0], obs: 'Dificuldade em pot√™ncia reativa' }));
            tbody.appendChild(criarLinha({ nome: 'Lucas Oliveira', notas: [9.5,9.0,9.5,8.5,9.0,8.5,9.0], obs: '√≥timo desempenho geral' }));
        }

        function coletarDadosCompletos() {
            const linhas = Array.from(tbody.querySelectorAll('tr'));
            const alunos = linhas.map(tr => {
                const nameInput = tr.querySelector('.aluno-nome .edit-name-input');
                const nome = nameInput ? nameInput.value.trim() : 'Nome do aluno';
                const inputs = tr.querySelectorAll('input.nota-criterio');
                const notas = [];
                inputs.forEach(inp => {
                    let val = parseFloat(inp.value);
                    if (isNaN(val)) val = 0;
                    notas.push(val);
                });
                const obsInput = tr.querySelector('.obs-cell input[type="text"]');
                const obs = obsInput ? obsInput.value : '';
                return { nome, notas, obs };
            });

            const criterionHeaders = criterionInputs.map(input => input.value.trim());

            return {
                alunos: alunos,
                docenteObs: docenteTextarea.value,
                docentName: docentNameInput.value.trim(),
                courseName: courseNameInput.value.trim(),
                courseContext: courseContextInput.value.trim(),
                curricularUnit: curricularUnitInput.value.trim(),
                desafio: desafioInput.value.trim(),
                criterionHeaders: criterionHeaders,
            };
        }

        function carregarDados(dados) {
            tbody.innerHTML = '';
            if (dados.alunos && Array.isArray(dados.alunos) && dados.alunos.length > 0) {
                dados.alunos.forEach(al => tbody.appendChild(criarLinha(al)));
            } else {
                inicializarExemplos();
            }
            docenteTextarea.value = dados.docenteObs || '';

            docentNameInput.value = dados.docentName || 'ESTER MAIA';
            docentNameStatic.textContent = docentNameInput.value;
            courseNameInput.value = dados.courseName || 'T√âCNICO EM ELETROT√âCNICA';
            courseNameStatic.textContent = courseNameInput.value;
            courseContextInput.value = dados.courseContext || 'ESCOLA INTEGRAL ¬∑ 1¬∫ ANO ¬∑ MATRIZ 1.640H ¬∑ 2022-2024';
            courseContextStatic.textContent = courseContextInput.value;
            curricularUnitInput.value = dados.curricularUnit || 'DISCIPLINA DE AN√ÅLISE DE CIRCUITOS';
            curricularUnitStatic.textContent = curricularUnitInput.value;
            desafioInput.value = dados.desafio || 'üìã DESAFIO: Portf√≥lio ‚Äì Etapa 2 (ESPEC√çFICO I - ELETRICIDADE)';
            desafioStatic.textContent = desafioInput.value;

            const defaultCriterionHeaders = [
                '1. CC¬∑ Tens√µes e correntes',
                '1. CC¬∑ Resist√™ncia equiv.',
                '1. CC¬∑ Pot√™ncia total',
                '2. CA¬∑ Tens√µes/correntes eficazes',
                '2. CA¬∑ Imped√¢ncia equiv.',
                '2. CA¬∑ Pot. aparente/ativa/reativa',
                '‚öñÔ∏è Aval. equipe + cr√≠tica'
            ];
            for (let i = 0; i < 7; i++) {
                criterionInputs[i].value = (dados.criterionHeaders && dados.criterionHeaders[i]) || defaultCriterionHeaders[i];
                criterionStatics[i].textContent = criterionInputs[i].value;
            }

            setupEditableField(docentNameStatic, docentNameInput, docentNameEditBtn, 'ESTER MAIA');
            setupEditableField(courseNameStatic, courseNameInput, courseNameEditBtn, 'T√âCNICO EM ELETROT√âCNICA');
            setupEditableField(courseContextStatic, courseContextInput, courseContextEditBtn, 'ESCOLA INTEGRAL ¬∑ 1¬∫ ANO ¬∑ MATRIZ 1.640H ¬∑ 2022-2024');
            setupEditableField(curricularUnitStatic, curricularUnitInput, curricularUnitEditBtn, 'DISCIPLINA DE AN√ÅLISE DE CIRCUITOS');
            setupEditableField(desafioStatic, desafioInput, desafioEditBtn, 'üìã DESAFIO: Portf√≥lio ‚Äì Etapa 2 (ESPEC√çFICO I - ELETRICIDADE)');
            for (let i = 0; i < 7; i++) {
                setupEditableField(criterionStatics[i], criterionInputs[i], criterionEditBtns[i], defaultCriterionHeaders[i]);
            }

            atualizarTodasMedias();
        }

        function salvarNoLocalStorage() {
            localStorage.setItem(LOCAL_STORAGE_KEY, JSON.stringify(coletarDadosCompletos()));
        }

        function carregarDoLocalStorage() {
            const salvo = localStorage.getItem(LOCAL_STORAGE_KEY);
            if (salvo) {
                try {
                    carregarDados(JSON.parse(salvo));
                    alert('Dados carregados do navegador.');
                } catch (e) {
                    alert('Erro ao carregar dados. Iniciando exemplo.');
                    tbody.innerHTML = '';
                    inicializarExemplos();
                    docenteTextarea.value = '';
                }
            } else {
                alert('Nenhum dado salvo encontrado. Come√ßando com exemplo.');
                tbody.innerHTML = '';
                inicializarExemplos();
                docenteTextarea.value = '';
            }
        }

        // üîß FUN√á√ÉO DE PDF CORRIGIDA ‚Äì GERA APENAS INFORMA√á√ïES RELEVANTES
        async function downloadPdf() {
            loadingOverlay.style.display = 'flex';
            downloadPdfBtn.disabled = true;

            try {
                // 1. For√ßar sa√≠da de todos os modos de edi√ß√£o
                document.querySelectorAll('.edit-name-input, .editable-input, .editable-header-input, .editable-desafio-input, .editable-th-input').forEach(input => {
                    if (input.style.display === 'inline-block') input.blur();
                });
                await new Promise(resolve => setTimeout(resolve, 150)); // Aguarda re-renderiza√ß√£o

                // 2. Clonar o container principal
                const clone = mainContainer.cloneNode(true);

                // 3. Remover do clone todos os elementos interativos/desnecess√°rios
                // Bot√µes de edi√ß√£o (qualquer elemento com classe edit-btn, edit-name-btn, th-edit-btn, btn-remove)
                clone.querySelectorAll('.edit-btn, .edit-name-btn, .th-edit-btn, .btn-remove').forEach(el => el.remove());

                // Inputs de edi√ß√£o (que ainda possam estar presentes)
                clone.querySelectorAll('.edit-name-input, .editable-input, .editable-header-input, .editable-desafio-input, .editable-th-input').forEach(el => el.remove());

                // Barra de ferramentas e rodap√©
                clone.querySelector('.toolbar')?.remove();
                clone.querySelector('.footer-note')?.remove();

                // Remover a coluna "A√ß√µes" (th e todas as c√©lulas correspondentes)
                const table = clone.querySelector('table');
                if (table) {
                    const theadRow = table.querySelector('thead tr');
                    if (theadRow) {
                        const thAcoes = Array.from(theadRow.children).find(th => th.textContent.includes('üóëÔ∏è A√ß√µes'));
                        if (thAcoes) {
                            const acaoIndex = Array.from(theadRow.children).indexOf(thAcoes);
                            thAcoes.remove(); // remove o th

                            // Remove as c√©lulas de a√ß√£o de cada linha do tbody
                            const rows = table.querySelectorAll('tbody tr');
                            rows.forEach(row => {
                                if (row.children.length > acaoIndex) {
                                    row.children[acaoIndex].remove();
                                }
                            });
                        }
                    }
                }

                // 4. Criar um container tempor√°rio para o clone (fora da view, para captura)
                const wrapper = document.createElement('div');
                wrapper.style.position = 'absolute';
                wrapper.style.left = '-9999px';
                wrapper.style.top = '0';
                wrapper.style.width = mainContainer.offsetWidth + 'px';
                wrapper.appendChild(clone);
                document.body.appendChild(wrapper);

                // 5. Capturar o clone com html2canvas
                const canvas = await html2canvas(clone, {
                    scale: 2,
                    useCORS: true,
                    windowWidth: clone.scrollWidth,
                    windowHeight: clone.scrollHeight,
                    scrollX: 0,
                    scrollY: 0,
                    logging: false,
                    allowTaint: false
                });

                // 6. Gerar PDF
                const imgData = canvas.toDataURL('image/png');
                const { jsPDF } = window.jspdf;
                const pdf = new jsPDF('p', 'mm', 'a4');
                const imgWidth = 210;
                const pageHeight = 297;
                const imgHeight = (canvas.height * imgWidth) / canvas.width;
                let heightLeft = imgHeight;
                let position = 0;

                pdf.addImage(imgData, 'PNG', 0, position, imgWidth, imgHeight);
                heightLeft -= pageHeight;

                while (heightLeft > 0) {
                    position = heightLeft - imgHeight;
                    pdf.addPage();
                    pdf.addImage(imgData, 'PNG', 0, position, imgWidth, imgHeight);
                    heightLeft -= pageHeight;
                }

                pdf.save('ficha-avaliacao.pdf');

                // 7. Limpar o wrapper
                document.body.removeChild(wrapper);
            } catch (error) {
                console.error('Erro no PDF:', error);
                alert('Erro ao gerar PDF. Tente novamente.');
            } finally {
                loadingOverlay.style.display = 'none';
                downloadPdfBtn.disabled = false;
            }
        }

        addBtn.addEventListener('click', () => {
            tbody.appendChild(criarLinha({ nome: '', notas: [0,0,0,0,0,0,0], obs: '' }));
            salvarNoLocalStorage();
        });
        saveBtn.addEventListener('click', salvarNoLocalStorage);
        loadBtn.addEventListener('click', carregarDoLocalStorage);
        downloadPdfBtn.addEventListener('click', downloadPdf);

        // Inicializa√ß√£o
        (function iniciar() {
            const salvo = localStorage.getItem(LOCAL_STORAGE_KEY);
            if (salvo) {
                try {
                    carregarDados(JSON.parse(salvo));
                } catch (e) {
                    inicializarExemplos();
                }
            } else {
                inicializarExemplos();
            }

            setupEditableField(docentNameStatic, docentNameInput, docentNameEditBtn, 'ESTER MAIA');
            setupEditableField(courseNameStatic, courseNameInput, courseNameEditBtn, 'T√âCNICO EM ELETROT√âCNICA');
            setupEditableField(courseContextStatic, courseContextInput, courseContextEditBtn, 'ESCOLA INTEGRAL ¬∑ 1¬∫ ANO ¬∑ MATRIZ 1.640H ¬∑ 2022-2024');
            setupEditableField(curricularUnitStatic, curricularUnitInput, curricularUnitEditBtn, 'DISCIPLINA DE AN√ÅLISE DE CIRCUITOS');
            setupEditableField(desafioStatic, desafioInput, desafioEditBtn, 'üìã DESAFIO: Portf√≥lio ‚Äì Etapa 2 (ESPEC√çFICO I - ELETRICIDADE)');
            const defaultCriterionHeaders = [
                '1. CC¬∑ Tens√µes e correntes',
                '1. CC¬∑ Resist√™ncia equiv.',
                '1. CC¬∑ Pot√™ncia total',
                '2. CA¬∑ Tens√µes/correntes eficazes',
                '2. CA¬∑ Imped√¢ncia equiv.',
                '2. CA¬∑ Pot. aparente/ativa/reativa',
                '‚öñÔ∏è Aval. equipe + cr√≠tica'
            ];
            for (let i = 0; i < 7; i++) {
                setupEditableField(criterionStatics[i], criterionInputs[i], criterionEditBtns[i], defaultCriterionHeaders[i]);
            }

            let debounceTimer;
            document.addEventListener('input', () => {
                clearTimeout(debounceTimer);
                debounceTimer = setTimeout(salvarNoLocalStorage, 1000);
            });
        })();
    })();
</script>
</body>
</html>
